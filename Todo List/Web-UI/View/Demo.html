
<!DOCTYPE html manifest>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport"
	content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">

<title>iScroll demo: bounce easing</title>
<link rel="stylesheet" type="text/css" href="../Styles/Demo.css" />
<link rel="stylesheet" type="text/css" href="../Styles/animate.css" />
<!-- <link rel="stylesheet" type="text/css"
	href="../Styles/magnific-popup.css" /> -->
<!-- <link rel="stylesheet" type="text/css" href="../Styles/Todo.css" /> -->
<script type="text/javascript" src="../Scripts/jquery-1.8.js"></script>
<!-- <script type="text/javascript" src="../Scripts/jqueryMobile1.3.2.js"></script> -->
<script type="text/javascript" src="../Scripts/Todo.js"></script>
<script type="text/javascript" src="../Scripts/jquery.transit.js"></script>
<script type="text/javascript" src="../Scripts/jquery.wipetouch.js"></script>
<script type="text/javascript" src="../Scripts/iScroll5/iscroll.js"></script>
<script type="text/javascript" src="../Scripts/DBLogic.js"></script>
<script type="text/javascript"
	src="../Scripts/Magnific-popup/jquery.magnific-popup.js"></script>
<style type="text/css">
/* li { */
/* 	-vendor-animation-duration: 3s; */
/* 	-vendor-animation-delay: 2s; */
/* 	-vendor-animation-iteration-count: infinite; */
/* } */
li.added {
	-vendor-animation-duration: 3s;
	-vendor-animation-delay: 2s;
	-vendor-animation-iteration-count: infinite;
}
</style>
<script type="text/javascript">
	var myScroll;

	$(function(){

		$('ul li.task span.tiles div.Name, ul li.task span.tiles div.Description').magnificPopup({
		  type:'inline',
		  removalDelay: 500,
		  midClick: true,
		  mainClass: 'mfp-zoom-in'
		});

	});
	
	
	window.verticalSwipeDist = 0;

	function loaded() {
        
        /* Wait for sometime, so that the tasks stored in the 
           DB will get loaded into the string 'tasksList'*/
        setTimeout(function () {
	        var scrollableList =$('div#scroller ul');
	        scrollableList.prepend(tasksList);
        }, 100);

		myScroll = new IScroll('#wrapper', {
			bounceEasing : 'elastic',
			bounceTime : 1200
		});
		/* myScroll.options.onBeforeScrollEnd = function(){
				alert("as");
				// Code for adding a task-li that appears in the top.
			} */

		positionOfFirstTile = $("#scroller").offset().top;

		myScroll.on('scrollStart', function() {
			// 			debugger;
			positionOfFirstTile = $("#scroller").offset().top;
			$('#wrapper').on('vmouseup', function(e) {
				alert("Touch Start.");
				e.preventDefault();
			}, false);
		});
		myScroll
				.on(
						'scrollEnd',
						function() {
							// 			debugger;
							if ($("#scroller").offset().top == 71
									&& positionOfFirstTile == 71) {
								$('#wrapper').trigger('vmouseup');
								$('#wrapper').off('vmouseup');

								//If the vertically scrolled distance is <200px, don't render the Tile for the new task. 
								if (window.verticalSlideDist < 200)
									return;

								/**
								 * Code for the text-box, to enter the Task-name and the description.
								 */
								var newTaskId = parseInt($('li.task span:first').attr('taskid')) - 1;
								var newTakHTML = '<li class="task added"><span class="tiles"  TaskId="'+newTaskId+'">'
										+ '<div class="Name">New Task</div>'
										+ '<div class="Description">Description</div>'
										+ '<div class="taskTime"></div>'
										+ '</span></li>';

								// Add a new tile to the List, and bind an event listener for the slide-to-delete event.
								$("div#scroller ul").prepend(newTakHTML);
								setTimeout(function() {
												$('li.animated.bounceIn').removeClass(
														'animated bounceIn');
											}, 1000);
								$('li.task:first').on('dblclick',
										function() {
											/*if( window.verticalSlideDist >5){
												window.verticalSlideDist = 0;
												return;
											}*/
											debugger;
											$('#wrapper').css('display', 'none');
											$('#test-popup').css('display', 'block');
											console.log($(this).find('.Name').html().trim());
											console.log($(this).find('.Description').html().trim());
											console.log( $(this).find('span').attr('TaskId'));
											debugger;
											$('#test-popup textArea#Description').val( $(this).find('.Description').html().trim() );
											$('#test-popup input#Name').val( $(this).find('.Name').html().trim() );
											debugger;
											$('#test-popup #TaskId').val( $(this).find('span').attr('TaskId'));
											var dateTime = new Date($(this).find('.taskTime').html().trim())
											var date =  dateTime.getFullYear() +"-"+
														((dateTime.getMonth() + 1)<10? ('0'+(dateTime.getMonth() + 1)): (dateTime.getMonth() + 1) )+"-"+
														((dateTime.getDate() < 10 )? ('0'+dateTime.getDate()) : dateTime.getDate());
											var time = ((dateTime.getHours()<10)?('0'+dateTime.getHours()): dateTime.getHours() )+":"+
													   ((dateTime.getMinutes()<10)?('0'+dateTime.getMinutes()): dateTime.getMinutes() )+":"+
													   ((dateTime.getSeconds()<10)?('0'+dateTime.getSeconds()): dateTime.getSeconds() );
										});
								$("div#scroller ul li:first")
										.wipetouch(
												{
													wipeLeft : function(result) {
														console.log("LEFT");
														var deletedTaskLi = $(
																result.source)
																.parent()
																.parent();

														if ($(result.source)
																.hasClass(
																		"tiles"))
															deletedTaskLi = $(
																	result.source)
																	.parent();
														else if ($(
																result.source)
																.hasClass(
																		"task"))
															deletedTaskLi = $(result.source);

														debugger;
														debugger;
														deletedTaskLi
																.transit(
																		{
																			marginLeft : 0,
																			opacity : 1.00
																		},
																		"slow",
																		function() {
																			console
																					.log("Swiped Left")
																			//alert("Right")
																		});
														//console.log(result.x + " , " + result.y + " : " + result.speed);
													},
													wipeRight : function(result) {
														console.log("RIGHT");
														var takLi = $(
																result.source)
																.parent()
																.parent();
														if ($(result.source)
																.hasClass(
																		"tiles"))
															takLi = $(
																	result.source)
																	.parent();
														else if ($(
																result.source)
																.hasClass(
																		"task"))
															takLi = $(result.source);
														debugger;
														debugger;
														takLi
																.transit(
																		{
																			marginLeft : takLi
																					.outerWidth() + 20,
																			opacity : 0.25
																		},
																		"slow",
																		function() {
																			console
																					.log("Swiped Right")
																			//alert("Left")
																		})
																.transit(
																		{
																			height : 0,
																			padding : 0,
																			margin : 0
																		//Reason for geany effect.
																		},
																		"slow",
																		function() {
																			debugger;
																			deleteTask(takLi.find("[TaskID]").attr('TaskId'));
																			var nextTask = takLi.next();
																			nextTask.transit(
																							{
																								top : 0
																							},
																							"fast");
																			//takLi.remove();
																		});
														//console.log(result.x + " , " + result.y + " : " + result.speed);
													},
													wipeUp : function(result) {
														console.log("UP");
														console.log(result.x
																+ " , "
																+ result.y
																+ " : "
																+ result.speed);
													},
													wipeDown : function(result) {
													},
													wipeMove : function(result) {
													}
												});
								// 				$('div#scroller ul li["class!=added"]').transition({ y: '40px' });
								$('div#scroller ul li.added').addClass(
										'animated bounceIn');
								$('div#scroller ul li.added').removeClass(
										'added');
								myScroll.refresh();
								//alert("Touch End.");
							}
						});
	}
</script>

</head>
<body onload="loaded()">
	<div id="header">Todo List</div>

	<div id="wrapper">
		<div id="scroller">
			<ul>
				<li class="task" style="height:350px;"><span class="tiles" TaskId='0'>
						<div class="Name">
							Tutorial
						</div>
						<div class="Description">This is the description of Task 1
							and its overflowing.</div>
				</span></li>
				<li style="list-style-type: none;"></li>

			</ul>
		</div>
	</div>
	<!-- Binding Event-handlers for "Ok" and "Cancel" button in pop-up window. -->
	<script type="text/javascript">
	$(function(){
		function preventPropogation(e){
			e.stopPropagation();
			e.preventDefault();
		}
		$('#test-popup textArea#Description, #test-popup input#Name').on('click', preventPropogation);
		
		/* Update the List view, hide the Edit-task view and display the List
		 * Also add/update the task in the DB.
		 */
		$('#Ok').on('click', function(){
			$('#wrapper').css('display', 'block');
			$('#test-popup').css('display', 'none');
			
			var taskId = $("#test-popup input#TaskId").val();
			var taskName = $("#test-popup input#Name").val();
			var taskDescription = $("#test-popup textArea#Description").val();
			var taskDateArray = $("#test-popup input#datepicker").val().split('-');
			var taskTimeArray = $("#test-popup input#timepicker").val().split(':');

			var taskObj = 	{
						"id"	: parseInt(taskId),
						"name" 	: taskName, 
						"description" : taskDescription,
						"taskTime" : new Date(taskDateArray[0], 
												taskDateArray[1],
												taskDateArray[2],
												taskTimeArray[0],
												taskTimeArray[1])
					};

			debugger;
			var taskInTheList = "span[TaskId^='"+ taskId +"']";
			addOrUpdateTask( taskId, taskObj );
			console.log(taskObj);

			$(taskInTheList).find(".Name").html( taskName );
			$(taskInTheList).find(".Description").html( taskDescription );
			$(taskInTheList).find(".taskTime").html( taskObj.taskTime );
			/* Animating the updated task, in the List View */
			$(taskInTheList).parent().addClass('animated tada');
			$(taskInTheList).parent().find('.Description').attr('height','400px');
			$(taskInTheList).parent().addClass('animated tada');
			
			/* Removing the Animation-CSS from the updated task, in the List View */
			setTimeout( function(){
				$('li.task').removeClass('animated tada');
			}, 1000);
		})
		
		$('#Cancel').on( 'click', function(e){
			debugger;
			$('#wrapper').css('display', 'block');
			$('#test-popup').css('display', 'none');
		});
	})
	</script>
	<div id="test-popup" class="white-popup mfp-with-anim mfp-hide task" style="display: none;">
		<input type="text" value="Name" id="Name" style="width: 80%"/><br>
		<textarea rows="5" cols="" value="Description..." id="Description" style="width: 80%"></textarea><br>
		<input type="hidden" id='TaskId' value="">
		<input id="datepicker" type="date" ><br>
		<input id="timepicker" type="time"><br>
		<!-- <button onclick="document.getElementById('datepicker').focus()" style="display:none;visibility:hidden;opacity:0;"></button><br>
		<button onclick="document.getElementById('timepicker').focus()" style="display:none;visibility:hidden;opacity:0;"></button> -->
		<button id='Ok'>Ok</button>
		<button id='Cancel'>Cancel</button>
	</div>



	<!-- <div id="footer"></div> -->

</body>
</html>